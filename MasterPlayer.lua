---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by ninovanhooff.
--- DateTime: 25/08/2022 22:19
---

lume = import "lume"
import "CoreLibs/object"
import "midi.lua"

class("MasterPlayer").extends()

function MasterPlayer:init(songPath)
    MasterPlayer.super.init()

    if self.sequence then
        self.sequence:stop()
        self.trackProps = nil
    end
    self.trackProps = json.decodeFile(songPath .. ".json")
    print(songPath, trackProps)
    self.sequence, self.trackProps = loadMidi(songPath, self.trackProps)
end

function MasterPlayer:play()
    self.sequence:play()
end

function MasterPlayer:stop()
    self.sequence:stop()
end

function MasterPlayer:setVolume(vol)
    for i, item in ipairs(self.trackProps) do
        local effectiveVolume = vol * item.volume
        self.sequence:getTrackAtIndex(i):getInstrument():setVolume(effectiveVolume)
    end
end
